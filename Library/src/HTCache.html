<HTML>
<HEAD>
  <TITLE>W3C Reference Library libwww Persistent Cache Manager</TITLE>
</HEAD>
<BODY>
<H1>
  Persistent Cache Manager
</H1>
<PRE>
/*
**	(c) COPYRIGHT MIT 1995.
**	Please first read the full copyright statement in the file COPYRIGH.
*/
</PRE>
<P>
The cache contains details of persietent files which contain the contents
of remote documents. The existing cache manager is somewhat naive - especially
in its garbage collection but it is just an example of how it can be done.
More advanced implementations are welcome!
<P>
This module is implemented by <A HREF="HTCache.c">HTCache.c</A>, and it is
a part of the <A HREF="http://www.w3.org/pub/WWW/Library/">W3C Reference
Library</A>.
<PRE>
#ifndef HTCACHE_H
#define HTCACHE_H

#include "WWWLib.h"
</PRE>
<H2>
  Cache Creation and Deletion
</H2>
<P>
The persistent cache has a set of overall parameters &nbsp;that you can adust
<H3>
  Enable Cache
</H3>
<P>
If <EM>cache_root</EM> is NULL then reuse old value or use
<CODE>HT_CACHE_ROOT</CODE>. An empty string will make '/' as cache root.
<PRE>extern BOOL HTCache_enable		(const char * cache_root);
</PRE>
<H3>
  Disable Cache
</H3>
<P>
Turns off the cache. Note that the cache can be disabled and enabled at any
time. The cache root is kept and can be reused during the execution.
<PRE>extern BOOL HTCache_disable		(void);
</PRE>
<H3>
  Is Cache Enabled
</H3>
<P>
Returns YES or NO. Also makes sure that we have a root value (even though
it might be invalid)
<PRE>extern BOOL HTCache_isEnabled		(void);
</PRE>
<H3>
  Where should the Cache Store its Contents
</H3>
<P>
If <EM>cache_root</EM> is NULL then the current value (might be a define)
Should we check if the cache_root is actually OK? I think not!
<PRE>extern BOOL HTCache_setRoot		(const char * cache_root);
extern const char *HTCache_getRoot	(void);
</PRE>
<H3>
  Delete Cache
</H3>
<P>
This is normally done automatically by the <A HREF="HTLib.html">Lib object</A>.
None of these functions touches the disk cache itself - they only manages
memory.
<PRE>extern void HTCache_freeRoot		(void);
extern void HTCache_clearMem		(void);
</PRE>
<P>
You can also prune the cache sompletely including the file objects.
<PRE>extern void HTCache_deleteAll		(void);
</PRE>
<H2>
  Cache Validation
</H2>
<H3>
  Verify if an Object is Valid
</H3>
<P>
This function checks whether a document has expired or not. The check is
based on the metainformation passed in the anchor object The function returns
<CODE>YES</CODE> or <CODE>NO</CODE>.
<PRE>extern BOOL HTCache_isValid (HTParentAnchor * anchor);
</PRE>
<H3>
  How do we handle Expiration of Cached Objects?
</H3>
<P>
There are various ways of handling <CODE>Expires</CODE> header when met in
a history list. Either it can be ignored all together, the user can be notified
with a warning, or the document can be reloaded automatically. This flag
decides what action to be taken. The default action is
<CODE>HT_EXPIRES_IGNORE</CODE>. In <CODE>HT_EXPIRES_NOTIFY</CODE> mode ,
we push a message on to the Error stack which is presented to the user.
<PRE>
typedef enum _HTExpiresMode {
    HT_EXPIRES_IGNORE = 0,
    HT_EXPIRES_NOTIFY,
    HT_EXPIRES_AUTO
} HTExpiresMode;

extern void HTCache_setExpiresMode (HTExpiresMode mode);
extern HTExpiresMode HTCache_expiresMode (void);
</PRE>
<H2>
  Filling the Cache and Cache Lookup
</H2>
<P>
Filling the cache is done as all other transportation of bulk data in libwww
using <A HREF="HTStream.html">streams</A>. The cache object creater is a
stream which in many cases sits on a <A HREF="HTTee.html">T stream</A> so
that we get the original feed and at the same time can parse the contents.
<PRE>extern HTConverter HTCacheWriter;
</PRE>
<H3>
  Find a Reference for a Cached Object
</H3>
<P>
Verifies if a cache object exists for this URL and if so returns a URL for
the cached object. It does not verify whether the object is valid or not,
for example it might have expired. Use the cache validation methods for checking
this.
<PRE>extern char * HTCache_getReference	(char * url);
</PRE>
<PRE>
#endif
</PRE>
<P>
  <HR>
<ADDRESS>
  @(#) $Id$
</ADDRESS>
</BODY></HTML>
