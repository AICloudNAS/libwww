<HTML>
<HEAD>
  <!-- Changed by: Henrik Frystyk Nielsen,  3-Apr-1996 -->
  <TITLE>W3C Reference Library libwww NET OBJECT</TITLE>
</HEAD>
<BODY>
<H1>
  Asyncronous Socket Management
</H1>
<PRE>
/*
**	(c) COPYRIGHT MIT 1995.
**	Please first read the full copyright statement in the file COPYRIGH.
*/
</PRE>
<P>
This module contains the routines for handling the set of active sockets
currently in use by the multithreaded clients. It is an internal module to
the Library, the application interface is implemented in the
<A HREF="HTEvent.html">Event Module</A>. Look for more information in the
<A HREF="http://www.w3.org/pub/WWW/Library/User/Architecture/"> Multithread
Specifications</A>.
<P>
This module is implemented by <A HREF="HTNet.c">HTNet.c</A>, and it is a
part of the <A HREF="http://www.w3.org/pub/WWW/Library/">W3C Reference
Library</A>.
<PRE>
#ifndef HTNETMAN_H
#define HTNETMAN_H
#include "HTNet.h"
#include "HTDNS.h"
#include "HTSocket.h"
#include "HTEvent.h"
#include "HTProt.h"
</PRE>
<H2>
  The HTNet Object
</H2>
<P>
The <CODE>HTNet</CODE> object is the core of the request queue management.
This object contains information about the socket descriptor, the input read
buffer etc. required to identify and service a request.
<P>
<PRE>
typedef enum _TCPState {
    TCP_ERROR		= -2,
    TCP_CONNECTED	= -1,
    TCP_BEGIN		= 0,
    TCP_DNS,
    TCP_NEED_SOCKET,
    TCP_NEED_BIND,
    TCP_NEED_LISTEN,
    TCP_NEED_CONNECT
} TCPState;

struct _HTNet {
    SOCKET		sockfd;				/* Socket descripter */
    FILE *		fp;			 /* If we can't use a socket */

    HTPriority		priority;	 /* Priority of this request (event) */
    BOOL		preemptive;  /* Eff result from Request and Protocol */

    /* Link to other objects */
    HTRequest *		request;		   /* Link to request object */
    HTProtocol *	protocol;		 /* Protocol to this request */
    HTTransport *	transport;	       /* Transport for this request */
    HTChannel *		channel;		 /* Channel for this request */
    HTHost *		host;	       /* What we know about the remote host */
    HTdns *		dns;			       /* Link to DNS object */

    /* For speed */
    HTEventCallback *	cbf;			   /* Protocol state machine */
    HTInputStream *	input;

    /* For progress notifications */
    long		bytes_read;		  /* Bytes read from network */
    long		bytes_written;		 /* Bytes written to network */

    /* Connection dependent stuff */
    TCPState		tcpstate;		      /* State in connection */
    SockA 		sock_addr;	     /* SockA is defined in sysdep.h */
    int			retry;		     /* Counting attempts to connect */
    int 		home;			 /* Current home if multiple */
    time_t		connecttime;		 /* Used on multihomed hosts */

    /* User specific stuff */
    void *		context;		/* Protocol Specific context */
};

#define HTNet_bytesRead(me)		((me) ? (me)-&gt;bytes_read : -1)
#define HTNet_bytesWritten(me)		((me) ? (me)-&gt;bytes_written : -1)

#define HTNet_setBytesRead(me,l)	((me) ? (me-&gt;bytes_read=(l)) : -1)
#define HTNet_setBytesWritten(me,l)	((me) ? (me-&gt;bytes_written=(l)) :-1)
</PRE>
<PRE>
#endif /* HTNETMAN_H */
</PRE>
<P>
  <HR>
<ADDRESS>
  @(#) $Id$
</ADDRESS>
</BODY></HTML>
