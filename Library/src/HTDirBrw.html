<HTML>
<HEAD>
<TITLE>Directory Browsing</TITLE>
</HEAD>
<BODY>
<H1>Directory Browsing</H1>
<PRE>#ifndef HTDIRBRW_H
#define HTDIRBRW_H
</PRE>
 
<H2>Controlling globals</H2>
These flags control how directories and files are represented as hypertext,
and are typically set by the application from command line options, etc.

<H3>Access Level of Directory Listing</H3>
<PRE>
extern int HTDirAccess;		                   /* Directory access level */
#define HT_DIR_FORBID 		0	             /* Altogether forbidden */
#define HT_DIR_SELECTIVE	1	     /* If HT_DIR_ENABLE_FILE exists */
#define HT_DIR_OK		2	          /* Any accesible directory */
#define HT_DIR_ENABLE_FILE	".www_browsable"    /* If exists, can browse */
</PRE>

<H3>Show a README file in the Listings?</H3>
<PRE>
extern int HTDirReadme;			 /* List a file in the dir listings? */
#define HT_DIR_README_NONE	0	                               /* No */
#define HT_DIR_README_TOP	1	                       /* Yes, first */
#define HT_DIR_README_BOTTOM	2	                  /* Yes, at the end */
#define HT_DIR_README_FILE	"README"
</PRE>

<H3>What Should the Listings Look Like?</H3>
Make a full mask by adding/oring the following flags: 

<PRE>
extern unsigned int HTDirShowMask;
typedef enum _HTDirShow {
    HT_DIR_SHOW_ICON  = 0x1,		                /* Show icons yes/no */
    HT_DIR_SHOW_MODE  = 0x2,		          /* Show permissions yes/no */
    HT_DIR_SHOW_NLINK = 0x4,		      /* Show number of links yes/no */
    HT_DIR_SHOW_OWNER = 0x8,		           /* Show owner name yes/no */
    HT_DIR_SHOW_GROUP = 0x10,			   /* Show group name yes/no */
    HT_DIR_SHOW_SIZE  = 0x20,	          /* Show file size using K, M and G */
    HT_DIR_SHOW_DATE  = 0x40,		                 /* Show date yes/no */
    HT_DIR_SHOW_HID   = 0x80,		         /* Show hidden files yes/no */
    HT_DIR_SHOW_SLINK = 0x200,      /* Show Symbolic links in italics yes/no */
    HT_DIR_ICON_ANCHOR= 0x400,	           /* Use icon OR filename as anchor */
    HT_DIR_SHOW_CASE  = 0x800,	      /* Sort case sensitive when string key */
    HT_DIR_KEY_SIZE   = 0x1000,	       	       /* Those are the sorting keys */
    HT_DIR_KEY_DATE   = 0x2000,
    HT_DIR_KEY_NAME   = 0x4000
    /* HT_DIR_KEY_TYPE   = 0x8000 not implemented yet!!! */
} HTDirShow;
</PRE>

The icon filenames are defined in the module.

<H3>How long can filenames be</H3>
The filename column varies within the boundaries specified as global
variables in HTDirBrw.c; filenames greated than
<CODE>HTDirMaxFileLength</CODE> will be truncated:
<PRE>
extern int HTDirMaxFileLength;
extern int HTDirMinFileLength;
</PRE>


<H3>Show byte count for small files</H3>
By default the size for files smaller than 1K will be shown as 1K.
If the global variable <CODE>HTDirShowBytes</CODE> is set to true,
they will be shown as bytes.
<PRE>
extern BOOL HTDirShowBytes;
</PRE>


<H3>Show brackets around alternative text</H3>
By default alternative text is bracketed by square brackets (the
<CODE>ALT</CODE> tag to <CODE>IMG</CODE> element).  Setting the global
<CODE>HTDirShowBrackets</CODE> to false will turn this feature off.
<PRE>
extern BOOL HTDirShowBrackets;
</PRE>


<H3>Descriptions</H3>

The <CODE>HTDirDescriptions</CODE> flag, if true, causes
<CODE>Description</CODE> field to be added as the last column in the
listing.  File descriptions are queried from the <A
HREF="HTDescript.html"><CODE>HTDescript</CODE> module</A>.  The
maximum length of this field is specified by
<CODE>HTDirMaxDescrLength</CODE>.
<PRE>
extern BOOL HTDirDescriptions;
extern int HTDirMaxDescrLength;
</PRE>


<H3>Rough estimate of max path length</H3>
<PRE>
#if defined(MAXPATHLEN)
#define HT_MAX_PATH MAXPATHLEN
#elif defined(PATH_MAX)
#define HT_MAX_PATH PATH_MAX
#else
#define HT_MAX_PATH 1024			      /* Any better ideas??? */
#endif
</PRE>

<<<<<<< HTDirBrw.html

<H3>Functions for directory browsing on local UNIX system</H3>

<PRE>
extern int HTBrowseDirectory PARAMS((
		HTRequest *  	req,
		char *		directory));
</PRE>

<H3>Functions for directory browsing from other sources</H3>

This is a pseudo stat file structure used for all other systems:

<PRE>
typedef struct _dir_file_info {
    char *		f_name;
    long 		f_mode;
    int			f_nlink;
    char *		f_uid;
    char *		f_gid;
    unsigned long	f_size;
    unsigned long	f_mtime;
} dir_file_info;
</PRE>

<H2>Where do FTP Directory Listings get input?</H2>
This function fills out the EntryInfo fil structure and should return 

<UL>
<LI>If error: -1
<LI>EOF or interrupted by user: 0
<LI>If succes and more to read: 1
</UL>

=======

<H2>Icons</H2>

Icons are bound to MIME content-types and encoding.  These functions
bind icon URLs to given content-type or encoding templates.  Templates
containing a slash are taken to be content-type templates, other are
encoding templates. <P>

All of these functions take an absolute URL and alternate text to use. <P>

<PRE>
/*
 * General icon binding.  Use this icon if content-type or encoding
 * matches template.
 */
PUBLIC void HTAddIcon PARAMS((char *	url,
			      char *	alt,
			      char *	type_templ));

/*
 * Icon for which no other icon can be used.
 */
PUBLIC void HTAddUnknownIcon PARAMS((char * url,
				     char * alt));

/*
 * Invisible icon for the listing header field to make it aligned
 * with the rest of the listing (this doesn't have to be blank).
 */
PUBLIC void HTAddBlankIcon PARAMS((char * url,
				   char * alt));

/*
 * Icon to use for parent directory.
 */
PUBLIC void HTAddParentIcon PARAMS((char * url,
				    char * alt));

/*
 * Icon to use for a directory.
 */
PUBLIC void HTAddDirIcon PARAMS((char * url,
			         char * alt));
</PRE>


<H4>A Predifined Set of Icons</H4>
The function <CODE>HTStdIconInit(url_prefix)</CODE> can be used to
initialize a standard icon set:
<UL>
<LI> <CODE>blank.xbm</CODE> for the blank icon
<LI> <CODE>directory.xbm</CODE> for directory icon
<LI> <CODE>back.xbm</CODE> for parent directory
<LI> <CODE>unknown.xbm</CODE> for unknown icon
<LI> <CODE>binary.xbm</CODE> for binary files
<LI> <CODE>text.xbm</CODE> for ascii files
<LI> <CODE>image.xbm</CODE> for image files
<LI> <CODE>movie.xbm</CODE> for video files
<LI> <CODE>sound.xbm</CODE> for audio files
<LI> <CODE>tar.xbm</CODE> for tar and gtar files
<LI> <CODE>compressed.xbm</CODE> for compressed and gzipped files
</UL>
<PRE>
PUBLIC void HTStdIconInit PARAMS((char * url_prefix));
</PRE>



<H2>Where do FTP Directory Listings get input?</H2>
This function fills out the EntryInfo fil structure and should return

<UL>
<LI>If error: -1
<LI>EOF or interrupted by user: 0
<LI>If succes and more to read: 1
</UL>

<PRE>
typedef int (*HTDirLineInput) PARAMS((void *));
</PRE>

<PRE>
extern int HTFTPBrowseDirectory PARAMS((
		HTRequest * 	req,
		char *		directory,
		HTDirLineInput  input));
</PRE>

<PRE>
#endif /* HTDIRBRW */
</PRE>
</BODY>
</HTML>
