<HTML>
<HEAD>
<TITLE>How to Build the WWW Libraries for Windows</TITLE>
<!-- Changed by: Henrik Frystyk Nielsen, 20-Nov-1995 -->
</HEAD>

<BODY>

<A HREF="../../../"><IMG ALT="W3C" SRC="../../../Icons/WWW/w3c_48x48.gif"></A>
<A HREF="../../"><IMG ALT="Lib" SRC="../../../Icons/WWW/Lib48x.gif"></A>
<A HREF="../../../LineMode/"><IMG ALT="LMB" SRC="../../../Icons/WWW/LMB48x.gif"></A>
<A HREF="./"><IMG ALT="OS" SRC="../../../Icons/WWW/Platform48x.gif"></A>

<H1>Building Window DLLs</H1>

<IMG SRC="../../../Icons/WWW/construction.gif"> This is under rapid construction. 
Please look at the <A HREF="../Using/">User's Guide</A> for more details. <P>

The WWW Libraries for Windows may be build many ways. The builder must decide 
on:

<OL>

<LI><A HREF="#lib">Library Types</A>: <A HREF="#static">static</A> vs <A
HREF="#dynamic">dynamic</A><BR>

<LI><A HREF="#select">Select Options</A>: <A HREF="#unix">unix-style select</A> vs <A
HREF="#async">WSAAsyncSelect</A><BR>

<LI><A HREF="#io">Input/Output Options</A>: <A HREF="#windowed">windowed</A> vs <A
HREF="#console">console</A>

</OL>

<A NAME="lib"><H2>Library Types:</H2></A>

When building the LibWWW for Windows (3.x) or WIN32 (NT, 95), you have the option of creating
seperate DLLs with defined interfaces. This is reccomended for WIN32 builds and required for Win 3.x
due to boundry size problems.

<A NAME="static"><H4>static</H4></A>

The libraries may be build as one large static library. This is how libwww is implemented on Unix
platforms. Subsequent references to the various DLLs may all be assumed to refer to the staticly
linked libwww. Care has been taken to insure that there are no <I>#define</I> conflicts where one
library would want a <I>#define</I> that would interfere with the modules in other libraries. When
building a static library, see the following sections on <A HREF="#select">Select Options</A> and <A
HREF="#io">Input/Output Options</A>, accumulate all the <I>#defines</I> that are required, and build
the whole libwww with those <I>#defines</I>. <P>

<IMG ALT="NOTE" SRC="../../../Icons/32x32/caution.gif"> Note - it is not recomended to staticly link
to the libraries if you are building a WIN16 application as it creates segment size problems.

<A NAME="dynamic"><H4>dynamic</H4></A>

The libwww has been divided up into several dynamic link libraries. The boundries between these DLLs
are based on module interdependancy and some assumptions regarding which modules may be replaced by
the application.  Unlike static linking, dynamic linking requires that all the modules in a DLL be
replaced at once. This is because the DLL needs all internal references to be resolved at build
time. Define <B>WWW_WIN_DLL</B> for all libraries that you are building as DLLs. This takes care of
dereferencing TTYPrint and WWW_TraceFlags.

<A NAME="dlls"><H4>list of DLLs</H4></A>

There are three basic libraries that you will need for any LibWWW application:

<OL>
<LI><A HREF="#dll">wwwdll.dll</A>
<LI><A HREF="#utils">wwwutils.dll</A>
<LI><A HREF="#core">wwwcore.dll</A>
<LI><A HREF="#cache">wwwcache.dll</A>
<LI><A HREF="#mime">wwwmime.dll</A>
<LI><A HREF="#http">wwwhttp.dll</A>
<LI><A HREF="#mlgen">wwwmlgen.dll</A>
<LI><A HREF="#rules">wwwrules.dll</A>
<LI><A HREF="#news">wwwnews.dll</A>
<LI><A HREF="#remaining">remaining modules</A>
</OL>

<A NAME="dll"><H2>wwwdll.dll</H2></A>

The wwwdll library is a tiny library that contains a pointer to the <A
HREF="TTYPrint.html">TTYPrint</A> function. When Windows loads a DLL, the exported function and data
pointers get "fixed up" in the other modules.  Consequently, what may be a directly addressable
piece of data in it's home library will be a pointer in the other libraries and executables that
dynamically link to it. The <A HREF="TTYPrint.html">TTYPrint</A> pointer is <A
HREF="..\Implementation\windll\wwwdll.def">exported</A> to the other modules and referenced via the
TTYPrint macro in <A HREF="../../Implementation/HTUtils.html">HTUtils.h</A>. <A HREF="#dll">wwwdll.dll
</A> also contains the WWW_TraceFlag to the same end of macroing the indirection.  <B>
Dependencies:</B> <I> windll.c wwwdll.c wwwdll.def </I>

<A NAME="utils"><H2>wwwutils.dll</H2></A>

The utils are a set of basic utilies that are used by the other libraries and may prove usefull
outside the context of the libwww. It implements linked lists, associative arrays, ... See <A
HREF="../../Implementation/WWWUtil.html"> Util Modules</A> for a description of the use of these
functions.  <B> Dependencies:</B> <I> wwwdll.lib windll.c wwwutils.def HTArray.c HTAssoc.c HTAtom.c
HTChunk.c HTList.c HTString.c HTUU.c </I>

<A NAME="core"><H2>wwwcore.dll</H2></A>

This library contains all the WWW specific functions needed to write an application that uses the
standard streams and converters, or produces it's own. See <A
HREF="../../Implementation/WWWCore.html">Core Modules</A> for a description of the use of these
functions.  <B> Dependencies:</B> <I> wwwdll.lib wwwutils.lib windll.c wwwcore.def HTAccess.c
HTAlert.c HTAnchor.c HTBind.c HTConLen.c HTDialog.c HTDNS.c HTError.c HTEscape.c HTEvnrg.c
HTFormat.c HTFWrite.c HTMethod.c HTNet.c HTParse.c HTProt.c HTReqMan.c HTSocket.c HTTCP.c HTTee.c
HTWriter.c HTWWWStr.c </I>


<A NAME="cache"><H2>wwwcache.dll</H2></A>

<B> Dependencies:</B> <I> wwwdll.lib wwwutils.lib windll.c wwwcache.def HTCache.c </I>

<A NAME="mime"><H2>wwwmime.dll</H2></A>

<B> Dependencies:</B>
<I>wwwdll.lib wwwutils.lib
wwwcore.lib windll.c wwwmime.def HTBound.c HTHeader.c HTMIME.c HTMIMERq.c </I>

<A NAME="http"><H2>wwwhttp.dll</H2></A>

<B> Dependencies:</B> <I>
wwwdll.lib
wwwutils.lib
wwwcore.lib
wwwcache.lib
wwwmime.lib
windll.c
wwwhttp.def
HTAABrow.c
HTAAUtil.c
HTAlert.c
HTTP.c
HTTPReq.c
</I>

<A NAME="mlgen"><H2>wwwmlgen.dll</H2></A>
<B> Dependencies:</B> <I>
wwwdll.lib
wwwutils.lib
wwwcore.lib
windll.c
wwwmlgen.def
HTMLGen.c
HTMLPDTD.c
</I>

<A NAME="rules"><H2>wwwrules.dll</H2></A>
<B> Dependencies:</B> <I>
wwwdll.lib
wwwutils.lib
wwwcore.lib
windll.c
wwwrules.def
HTAlert.c
HTProxy.c
HTRules.c
</I>

<A NAME="news"><H2>wwwnews.dll</H2></A>
<B> Dependencies:</B> <I>
wwwdll.lib
wwwutils.lib
wwwcore.lib
wwwmime.lib
wwwmlgen.lib
wwwnews.lib
windll.c
wwwnews.def
HTNDir.c
HTNews.c
HTNewsLs.c
HTNewsRq.c
</I>

<A NAME="remaining"><H2>remaining modules</H2></A>
Not all the modules have been incorporated into DLLs yet. Therefore, it is 
required that the application link directly to the remaining modules. In 
addition to it's own source files, the application will have the remaining
<B> Dependencies:</B> <I>
wwwdll.lib
wwwutils.lib
wwwcore.lib
wwwmime.lib
wwwhttp.lib
wwwmlgen.lib
wwwrules.lib
HTDir.c
HTFile.c
HTFTP.c
HTFTPDir.c
HTGopher.c
HTGuess.c
HTHist.c
HTHome.c
HTIcons.c
HTInit.c
HTLog.c
HTML.c
HTMulti.c
HTPlain.c
HTTelnet.c
HTTeXGen.c
HTWSRC.c
</I>

<H2>Make Files</H2>

MSVC2.2 Make files are available in the <A HREF="../../Implementation/windows"> windll</A>
directory. Each library is build from some .c files,

It is impoortant to build these libraries in the correct order. Observe the dependancies listed at
the end of each library description. The first dependancies are the lib files that were generated
when previous libraries were built.<P>

<H2>Extra Modules for the DLLs</H2>

<UL>
<LI><I>windll.c</I> - DLLMain to ALL DLLs.
<LI><I>wwwdll.c</I> - instances of PTTYPrint and WWW_TraceFlag. This is included in wwwdll so that
it can export the variables to the rest of the DLLs.
<LI><I>wwwdll.def, wwwutils.def, wwwcore.def</I> - def (exports) files for the DLLs of the same
names.
</UL>

<H2>Exporting Functions</H2>

The functions exported from a DLL are listed in the EXPORTS section of a .def file. These can be
found in the <A HREF="../../Implementation/windows">windll </A> directory. These may also be build by
the <A HREF="#makedefs"> makeDefs.pl</A> perl script.

<A NAME="makedefs"><H2>makeDefs.pl</H2></A>

makeDefs.pl is a perl 4 script which takes a list of modules and generates a list of exports from
them. The module list may be taken from the appropriate header file for the library, eg
<I>wwwutils.dll</I> uses <I>wwwutils.def</I> which is made from <I>WWWUtils.html</I>. The file list
assumes nothing except the module file names with no extensions so each line that says:<BR>
<I>#include "some file.h"</I> should be translated to <I>some file</I>.  As of the time of this
writing, there were to ways in which the library header files must be modified to give an accurate
list of the modules in a library.<BR> in WWWCore.html, <I>HTReq.h</I> shoud tranlate to
<I>HTReqMan</I><BR> and in WWWUtils.html, <I>HTUtils.h</I> should be removed from the list.

<A NAME="select"><H2>Select Options:</H2></A>

The library is designed around the standard, unix-style, select call. The Winsock spec defines a
Windows specific extension called WSAAsyncSelct.  Calling WSAAsyncSelect tells your Winsock.DLL to
pass messages to a window when I/O is ready on a socket.

<A NAME="unix"><H4>unix-style select</H4></A>

This is the default mode for the compilation. All sockets are registered via HTEvent_Register. A
select call in HTEvent_Loop processes these registered sockets and dispatches the appropriate
handlers.

<A NAME="async"><H4>WSAAsyncSelect</H4></A>

HTEvent_Register calls WSAAsyncSelect to register the sockets. HTEvent_Loop is a standard Windows
event loop that dispatches the results of the AsyncSelect calls and, optionally, the windows
messages for the <A HREF="#windowed">IO window</A>. Define <B>WWW_WIN_ASYNC</B> in the <A
HREF="#core">wwwcore</A> library to include WSAAsyncSelect logic.

<A NAME="io"><H2>Input/Output Options:</H2></A>

The IO has to go somewhere, right? In WIN32, there is a notion of a <A HREF="#console">console</A>
application. This means that all IO happens through a standard DOS shell interface, with a FILE
pointer like that in Unix. WIN16 users will have to use a Windows(r)(tm) window for IO. All the
libraries (except <A HREF="#dll">wwwdll.dll</A>) make calls to <A
HREF="TTYPrint.html">TTYPrint</A>. It is therefore important that all modules agree on whether they
are a console application or a windows application.

<A NAME="windowed"><H4>windowed</H4></A>

The HTBrowse.c file provides a main. However, as a window program, the LineMode browser needs a
LibMain. This is found in <A HREF="../../../LineMode/Implementation/windows/www.c">www.c</A>. Three
other modules, <A HREF="../../../LineMode/Implementation/windows/scroll.c">scroll.c</A> and <A
HREF="../../../LineMode/Implementation/windows/lib.c">lib.c</A> provide the window for the application.

<A NAME="console"><H4>console</H4></A>

The console option is available only in WIN32. All io happens through the WIN32 console window. This
model stronly resembles the unix model.  Define <B>_CONSOLE</B> for all libraries

<P>
<HR>
<ADDRESS><A HREF="../../../People.html#Prudamo">Eric Prud'hommeaux</A>, November 1995</ADDRESS>
</BODY>
</HTML>

